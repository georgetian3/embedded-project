\section{实验内容}

实验背景：本次实验的硬件系统采用MPU和MCU双平台设计，其中MPU用于Linux操作系统开发，MCU用于ARM体系结构与裸机编程。
本次实验会在Linux系统下进行。

实验前置知识：本次实验需要使用C语言来编写文件读取函数，并利用虚拟机交叉编译代码后，在开发平台上运行。
因此需要提前掌握一定的C语言基础。

实验目标：1、使用系统I/O函数读取wav音频文件，并将wav音频文件的参数输出到命令行。
2、将读取音频文件的参数写入开发平台上的txt文件中。
注：文件操作恤经过交叉编译并在开发平台上运行

\section{实验部署}

本次实验的实验设备是嵌入式开发板以及Windows10电脑。
开发板上要把STM32MP157芯片对应的启动方式拨码成EMMC启动模式，并插好电源开机。
在Windows10电脑中，实验使用Visual Studio Code进行代码编写，使用的语言为C。
实验没有使用说明中的VMware虚拟机，而是使用WSL来进行交叉编译。
电脑主机和开发板在实验过程中通过设置以太网ip地址和子网进行联通。

\section{实验过程}

具体实验中的操作步骤和重要的代码（注意，不要把所有代码全贴上来，只对你觉得最关键的代码环节，或者自己有创新型的优化进行说明，也可以放伪代码）；

操作步骤中可能出现的问题以及自己的解决方式（说的越详细越好，能够体现出你对实验，理论和系统底层的深入理解）。


\section{实验结果}

对测试集的描述，及用图片或者图表对测试结果进行描述。

有没有例外（不符合输出要求，或者达不到输出要求的样例），并分析为
什么会出现这样的结果。

分析实验在哪些方面还有改进的空间，如何提升效果，优化代码（比如
在嵌入式编程环境中，我们需要尽可能的优化代码执行文件的大小和执
行的速度，以及代码是否包含安全漏洞和可能存在的内存泄露等等）。


\begin{minted}[style=bw]{console}
root@myir:~# ./audioplayer-xc 
filename: 1 argument(s) expected. 0 provided.
Usage: music [--help] [--version] filename

Positional arguments:
    filename      Filename of the wave file

Optional arguments:
    -h, --help    shows help message and exits
    -v, --version prints version information and exits
root@myir:~# ./audioplayer-xc audioplayer-xc 
"audioplayer-xc" is not a valid wave file
root@myir:~# ./audioplayer-xc test.wav 
================================
test.wav
--------------------------------
RIFFChunk
    ID            RIFF
    Size          589860
    Format        WAVE
FormatChunk
    ID            fmt
    Size          16
    AudioFormat   1
    NumChannels   2
    SampleRate    44100
    ByteRate      176400
    BlockAlign    4
    BitsPerSample 16
DataChunk
    ID            data
    Size          589824
================================
\end{minted}

\section{实验心得}

对本次实验任务的评价，比如你在本次实验中学到了什么，实验对你的编程
能力有没有提升，实验的难度是否过大或者过于简单，可以向助教和老师提出相
关的意见等等。



\begin{itemize}
    \item 开发板的 DHCP 没有自动配置 IP 地址。
    
    手动在开发板以及主机上配置 IP。

    \item 在开发板上运行时出现错误：
    
    \code{./audioplayer-xc: /lib/libc.so.6: version `GLIBC_2.34' not found (required by ./audioplayer-xc)}
    
    由于主机的 glibc 的版本大于开发板上的 glibc 版本，所以在主机上交叉编译的可执行文件在开发板上找不到需要的库。使用 g++ 的 \code{-static} 编译参数进行静态链接。

    \item 开发板启动后，操作系统会默认开启 \code{mxapp2} 程序。在 Linux 系统上，通常输入 \keys{\ctrl+\Alt+Fn} 会切换到命令行，但是 \code{mxapp2} 似乎禁用了此功能。
    

    \item 编译 Alsa：为了得到开发板的平台信息，需要将 \code{config.guess} 拷贝到开发板上并运行，得到：\code{armv7l-unknown-linux-gnueabihf}
\end{itemize}

\section{编译与运行}

为开发板的 ARM 处理器进行交叉编译需要 Ubuntu 的 \code{g++-arm-linux-gnueabihf} 包：

\begin{codeblock}
sudo apt install g++-arm-linux-gnueabihf
arm-linux-gnueabihf-g++ wave.cpp -static -o music
\end{codeblock}
